{"version":3,"sources":["MainMenuManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["\"use strict\";\r\n\r\nimport ItemRoomScrollView from \"../Prefabs/ItemRoomScrollView\";\r\nimport { ConnectionManager } from \"./ConnectionManager\";\r\nimport SnapGame from \"./SnapGame\";\r\nimport WaitingRoomManager from \"./WaitingRoomManager\";\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class MainMenuManager extends cc.Component {\r\n    @property(cc.Label)\r\n    loginNameLbl: cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    connectionStatusLbl: cc.Label = null;\r\n\r\n    @property(cc.Button)\r\n    loginBtn: cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    logoutBtn: cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    reconnectBtn: cc.Button = null;\r\n\r\n    @property(cc.Prefab)\r\n    itemPrefab: cc.Prefab = null;\r\n\r\n    @property(cc.ScrollView)\r\n    roomScrollView: cc.ScrollView = null;\r\n\r\n    @property()\r\n    roomSceneName: string = \"\";\r\n\r\n    private readonly connection: ConnectionManager = ConnectionManager.getInstance();\r\n\r\n    onLoad(): void {\r\n        cc.systemEvent\r\n            .on(ConnectionManager.ON_CONNECTED, this.onConnected, this);\r\n        cc.systemEvent\r\n            .on(ConnectionManager.ON_CONNECTION_CLOSED, this.onDisconnected, this);\r\n        cc.systemEvent\r\n            .on(ConnectionManager.ON_PLAYER_LOGIN_EVENT, this.onLogin, this);\r\n        cc.systemEvent\r\n            .on(ConnectionManager.ON_CREATE_ROOM, this.onRoomCreated, this);\r\n        cc.systemEvent\r\n            .on(ConnectionManager.ON_JOIN_GAME_MESSAGE, this.onJoinGame, this);\r\n\r\n        this.refresh();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        cc.systemEvent\r\n            .off(ConnectionManager.ON_CONNECTED, this.onConnected, this);\r\n        cc.systemEvent\r\n            .off(ConnectionManager.ON_CONNECTION_CLOSED, this.onDisconnected, this);\r\n        cc.systemEvent\r\n            .off(ConnectionManager.ON_PLAYER_LOGIN_EVENT, this.onLogin, this);\r\n        cc.systemEvent\r\n            .off(ConnectionManager.ON_CREATE_ROOM, this.onRoomCreated, this);\r\n        cc.systemEvent\r\n            .off(ConnectionManager.ON_JOIN_GAME_MESSAGE, this.onJoinGame, this);\r\n    }\r\n\r\n    onJoinGame(e: cc.Event.EventCustom): void {\r\n        const joinedUser: string = e.getUserData().username;\r\n        const roomId: any = e.getUserData().roomId;\r\n        if (joinedUser === this.connection.player.username) {\r\n            cc.director.loadScene(this.roomSceneName, () => {\r\n                const scene: cc.Scene = cc.director.getScene();\r\n                const game: SnapGame = scene.getChildByName(\"Game\").getComponent(SnapGame);\r\n                const sceneManager: WaitingRoomManager = scene.getChildByName(\"WaitingRoomManager\").getComponent(WaitingRoomManager);\r\n                game.roomId = roomId;\r\n                sceneManager.loadData();\r\n            });\r\n        }\r\n    }\r\n\r\n    createRoom(): void {\r\n        this.connection.createRoom();\r\n    }\r\n\r\n    onRoomCreated(e: cc.Event.EventCustom): any {\r\n        const roomId: any = e.getUserData().roomId;\r\n        const createdBy: any = e.getUserData().createdBy;\r\n        if (createdBy === this.connection.player.username) {\r\n            cc.director.loadScene(this.roomSceneName, () => {\r\n                const scene: cc.Scene = cc.director.getScene();\r\n                const game: SnapGame = scene.getChildByName(\"Game\").getComponent(SnapGame);\r\n                const sceneManager: WaitingRoomManager = scene.getChildByName(\"WaitingRoomManager\").getComponent(WaitingRoomManager);\r\n                game.roomId = roomId;\r\n                game.createdBy = createdBy;\r\n                sceneManager.loadData();\r\n            });\r\n            return;\r\n        }\r\n        this.addRoomItem(roomId);\r\n    }\r\n\r\n    private addRoomItem(roomId: number): void {\r\n        cc.log(\"Game created received: \" + roomId);\r\n        const node: cc.Node = cc.instantiate(this.itemPrefab);\r\n        const item: ItemRoomScrollView = node.getComponent(ItemRoomScrollView);\r\n        item.id = roomId;\r\n        const lbl: cc.Label = node.getComponentInChildren(cc.Label);\r\n        lbl.string = `Room #${roomId}`;\r\n        const itemCount: number = this.roomScrollView.content.childrenCount;\r\n        const h: number = node.height + 5;\r\n        const y: number = (itemCount * h);\r\n        this.roomScrollView.content.addChild(node);\r\n        node.setPosition(0, -y);\r\n        this.roomScrollView.content.height += h;\r\n    }\r\n\r\n    onConnected(e: cc.Event.EventCustom): any {\r\n        this.connectionStatusLbl.string = \"Connected\";\r\n    }\r\n\r\n    onDisconnected(e: cc.Event.EventCustom): any {\r\n        this.connectionStatusLbl.string = \"Disconnected\";\r\n    }\r\n\r\n    onLogin(e: cc.Event.EventCustom): any {\r\n        this.loginNameLbl.string = this.connection.player.username;\r\n    }\r\n\r\n    connect(): void {\r\n        this.connection.connect();\r\n    }\r\n\r\n    refresh(): void {\r\n        this.connection.refresh();\r\n        fetch(\"https://localhost:44378/api/GameRoom\")\r\n            .then(data => {\r\n                return data.json();\r\n            }).then(rooms => {\r\n                rooms.forEach(room => {\r\n                    this.addRoomItem(room.id);\r\n                });\r\n            });\r\n    }\r\n\r\n    login(): void {\r\n        this.connection.login();\r\n    }\r\n\r\n    logout(): void {\r\n        this.connection.logout();\r\n    }\r\n}\r\n"]}